# Webserver-master

## 整体框架
- epoll ET模式（边缘触发）
- mysql(业务部分的内容）
- 连接池（数据库）
- 线程池
- 日志
- 定时器
- Reactor模式
- http
- 大端序和小端序互转hton
- 读写缓冲区

## 工作流程
- 1 主线程负责监听
- 2 主线程让epoll监听活跃的文件描述符
- 3 处理完之后开始工作线程
- 4 工作线程任务（读写分离，不同的线程操作）
- 5 读写缓冲区的设计 
-  read客户端数据（非阻塞IO)
-  业务逻辑
- 1）先去看读缓冲有没有数据
- 2）解析HTTP
- 3）生成响应数据
- 4）封装响应回传给客户端

## 相关技术问题
- 1 线程池的实现 1、主线程轮流选取子线程 2、通过共享队列+互斥量来实现同步 3、信号量来通信 4、同步问题
-  TCP连接过程中：当服务器和客户端TCP完成连接后，通过pthread_create()函数创建线程，然后将已连接socket的文件描述符传递给线程函数，接着在线程里和客户端进行通信，从而达到并发处理的目的。
- 这里需要注意的是：父进程accept之后会把socket放入一个队列，然后线程从这个队列中取socket做操作。因为这个队列是全局的，每个线程都会操作，为了多线程竞争，线程在这个操作这个队列前要加锁；
- 2 字节序相关的转换函数：从主机字节序到网络字节序的转换函数：htons htonl； 从网络字节序到主机字节序的转换函数:ntohs ntohl
- 3 HTTP相关
- HTTPS采用的对称加密和非对称加密的混合加密机制。在通信建立之前采用非对称加密的方式交换会话密钥，后续不再使用非对称加密。
- 通信过程中全部采用对称加密的会话密钥的方式加密明文数据。
- 采用混合加密的方式原因：
- 1）对称加密只使用一个密钥，运算速度快，密钥必须保密，无法做到安全的密钥交换；
- 2） 非对称加密使用两个密钥：公钥和私钥，公钥可以任意分发而私钥保密，解决了密钥交换问题但是速度慢。

## 服务器压力测试
- Webbench是常用的压力测试工具
- 1）测试处于相同的硬件上，不同服务的性能以及不同硬件上同一个服务的运行状况。
- 2）展示服务器的两项内容：每秒钟响应请求数和每秒钟传输数据量。
- 压力测试基本原理：Webbench首先fork出多个子进程，每个子进程都循环做web访问测试，子进程把访问的结果通过pipe告诉父进程，父进程做最后的统计。
- 网络相关的一些命令 查看端口状态netstat 抓包tcpdump  


